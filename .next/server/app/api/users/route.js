"use strict";(()=>{var e={};e.id=701,e.ids=[701],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72929:e=>{e.exports=import("firebase-admin/firestore")},57769:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>u,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var a=r(49303),o=r(88716),i=r(60670),n=r(77364),d=e([n]);n=(d.then?(await d)():d)[0];let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/users/route",pathname:"/api/users",filename:"route",bundlePath:"app/api/users/route"},resolvedPagePath:"/Users/kih/Documents/test/app/api/users/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:m}=c,f="/api/users/route";function u(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}s()}catch(e){s(e)}})},77364:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>u,POST:()=>d});var a=r(87070),o=r(84138),i=r(72929),n=e([i]);async function d(e){try{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return a.NextResponse.json({message:"Authorization header missing or malformed"},{status:401});let r=t.split(" ")[1];console.log("Backend received ID Token:",r);let s=await o.I8.verifyIdToken(r);console.log("Backend decoded Token:",s);let n=s.uid,d=s.email,{name:u,department:c,role:l}=await e.json();if(!u||!d||!l)return a.NextResponse.json({message:"Missing required fields (name, email, role)"},{status:400});if(!["user","staff","admin"].includes(l))return a.NextResponse.json({message:"Invalid role value. Must be one of: user, staff, admin"},{status:400});let p=o.RZ.collection("users").doc(n);if((await p.get()).exists)return a.NextResponse.json({message:"User document already exists"},{status:409});let m=i.Timestamp.now();return await p.set({name:u,email:d,role:l,department:c||void 0,createdAt:m,updatedAt:m}),a.NextResponse.json({message:"User document created successfully",userId:n},{status:201})}catch(r){console.error("Error creating user document:",r);let e="Internal Server Error",t=500;if(r instanceof Error){let s=r.code;"auth/argument-error"===s||"auth/id-token-expired"===s?(e="Invalid or expired token",t=401):e=r.message||e}return a.NextResponse.json({message:e},{status:t})}}async function u(e){try{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return a.NextResponse.json({message:"Authorization header missing or malformed"},{status:401});let r=t.split(" ")[1],s=(await o.I8.verifyIdToken(r)).uid,n=await o.RZ.collection("users").doc(s).get();if(!n.exists)return a.NextResponse.json({message:"User not found"},{status:404});let d=n.data();return a.NextResponse.json({id:n.id,...d,createdAt:d.createdAt instanceof i.Timestamp?d.createdAt.toDate().toISOString():d.createdAt,updatedAt:d.updatedAt instanceof i.Timestamp?d.updatedAt.toDate().toISOString():d.updatedAt})}catch(r){console.error("Error fetching user:",r);let e="Internal Server Error",t=500;if(r instanceof Error){let s=r.code;"auth/argument-error"===s||"auth/id-token-expired"===s?(e="Invalid or expired token",t=401):e=r.message||e}return a.NextResponse.json({message:e},{status:t})}}i=(n.then?(await n)():n)[0],s()}catch(e){s(e)}})},84138:(e,t,r)=>{let s,a;r.d(t,{I8:()=>a,RZ:()=>s});let o=require("firebase-admin");if(o.apps.length){let e=o.app();s=e.firestore(),a=e.auth(),console.log("Firebase Admin SDK already initialized.")}else try{o.initializeApp({projectId:process.env.FIREBASE_PROJECT_ID,credential:o.credential.cert({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g,"\n")})}),console.log("Firebase Admin SDK initialized for production mode."),s=o.firestore(),a=o.auth()}catch(e){throw console.error("Firebase admin initialization error:",e),Error("Failed to initialize Firebase Admin SDK.")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(57769));module.exports=s})();