"use strict";(()=>{var e={};e.id=146,e.ids=[146],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72929:e=>{e.exports=import("firebase-admin/firestore")},27999:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>u,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var s=t(49303),o=t(88716),n=t(60670),i=t(49934),d=e([i]);i=(d.then?(await d)():d)[0];let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"/Users/kih/Documents/test/app/api/orders/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:m}=c,h="/api/orders/route";function u(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}a()}catch(e){a(e)}})},49934:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{GET:()=>d,POST:()=>u});var s=t(87070),o=t(84138),n=t(72929),i=e([n]);async function d(e){try{let r=e.headers.get("Authorization");if(!r||!r.startsWith("Bearer "))return s.NextResponse.json({message:"Authorization header missing or malformed"},{status:401});let t=r.split(" ")[1];await o.I8.verifyIdToken(t);let a=await o.RZ.collection("orders").get(),i=[];return a.forEach(e=>{let r=e.data();i.push({id:e.id,...r,createdAt:r.createdAt instanceof n.Timestamp?r.createdAt.toDate().toISOString():r.createdAt,updatedAt:r.updatedAt instanceof n.Timestamp?r.updatedAt.toDate().toISOString():r.updatedAt})}),s.NextResponse.json(i)}catch(t){console.error("Error fetching orders:",t);let e="Internal Server Error",r=500;if(t instanceof Error){let a=t.code;"auth/argument-error"===a||"auth/id-token-expired"===a?(e="Invalid or expired token",r=401):e=t.message||e}return s.NextResponse.json({message:e},{status:r})}}async function u(e){try{let r=e.headers.get("Authorization");if(!r||!r.startsWith("Bearer "))return s.NextResponse.json({message:"Authorization header missing or malformed"},{status:401});let t=r.split(" ")[1],a=(await o.I8.verifyIdToken(t)).uid,i=(await o.RZ.collection("users").doc(a).get()).data();if(!i)return s.NextResponse.json({message:"User data not found"},{status:404});let{name:d,email:u}=i,{title:c,description:p,priority:l,quantity:m,url:h}=await e.json();if(!c||!p||!l||!m||m<=0)return s.NextResponse.json({message:"Missing or invalid required fields (title, description, priority, quantity)"},{status:400});let g=n.Timestamp.now(),f=await o.RZ.collection("orders").add({title:c,description:p,status:"PENDING",priority:l,requestedBy:{userId:a,name:d||"Unknown User",email:u||"unknown@example.com"},quantity:m,url:h,createdAt:g,updatedAt:g});return s.NextResponse.json({message:"Order created successfully",id:f.id},{status:201})}catch(e){if(console.error("Backend /api/orders: Error:",e),!(e instanceof Error))return console.error("Backend /api/orders: Caught an error that is not an Error object:",e),s.NextResponse.json({message:"Internal Server Error (Unknown Error Type)"},{status:500});{console.error("Backend /api/orders: Token verification failed (or other Error):",e.message);let r=e.code;if("auth/argument-error"===r||"auth/id-token-expired"===r)return s.NextResponse.json({message:"Invalid or expired token"},{status:401});return s.NextResponse.json({message:`Internal Server Error: ${e.message}`},{status:500})}}}n=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},84138:(e,r,t)=>{let a,s;t.d(r,{I8:()=>s,RZ:()=>a});let o=require("firebase-admin");if(o.apps.length){let e=o.app();a=e.firestore(),s=e.auth(),console.log("Firebase Admin SDK already initialized.")}else try{o.initializeApp({projectId:process.env.FIREBASE_PROJECT_ID,credential:o.credential.cert({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g,"\n")})}),console.log("Firebase Admin SDK initialized for production mode."),a=o.firestore(),s=o.auth()}catch(e){throw console.error("Firebase admin initialization error:",e),Error("Failed to initialize Firebase Admin SDK.")}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,972],()=>t(27999));module.exports=a})();