"use strict";(()=>{var e={};e.id=87,e.ids=[87],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72929:e=>{e.exports=import("firebase-admin/firestore")},66253:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>u,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var o=r(49303),i=r(88716),a=r(60670),n=r(51058),d=e([n]);n=(d.then?(await d)():d)[0];let l=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/orders/[id]/route",pathname:"/api/orders/[id]",filename:"route",bundlePath:"app/api/orders/[id]/route"},resolvedPagePath:"/Users/kih/Documents/test/app/api/orders/[id]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:m}=l,f="/api/orders/[id]/route";function u(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}s()}catch(e){s(e)}})},51058:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{DELETE:()=>l,GET:()=>d,PATCH:()=>u});var o=r(87070),i=r(84138),a=r(72929),n=e([a]);async function d(e,{params:t}){try{let r=e.headers.get("Authorization"),s=r?.split(" ")[1];if(s)try{(await i.I8.verifyIdToken(s)).uid}catch(e){console.warn("Invalid token for GET request:",e)}let n=t.id,d=await i.RZ.collection("orders").doc(n).get();if(!d.exists)return o.NextResponse.json({message:"Order not found"},{status:404});let u=d.data();if(!u)return o.NextResponse.json({message:"Order data is empty"},{status:404});let{id:l,...c}=u,p=e=>e instanceof a.Timestamp?e.toDate().toISOString():"string"==typeof e?e:null;return o.NextResponse.json({id:d.id,...c,createdAt:p(u.createdAt),updatedAt:p(u.updatedAt)})}catch(e){return console.error("Error fetching order:",e),o.NextResponse.json({message:"Internal Server Error"},{status:500})}}async function u(e,{params:t}){try{let r=e.headers.get("Authorization");if(!r||!r.startsWith("Bearer "))return o.NextResponse.json({message:"Authorization header missing or malformed"},{status:401});let s=r.split(" ")[1],n=(await i.I8.verifyIdToken(s)).uid,d=(await i.RZ.collection("users").doc(n).get()).data();if(d?.role!=="staff"&&d?.role!=="admin")return o.NextResponse.json({message:"Forbidden - Insufficient permissions"},{status:403});let u=t.id,{status:l,price:c,url:p}=await e.json(),m={updatedAt:a.Timestamp.now()};if(void 0!==l&&(m.status=l),void 0!==c&&(m.price=c),void 0!==p&&(m.url=p),Object.keys(m).length<=1&&!l&&!c&&!p)return o.NextResponse.json({message:"No valid fields to update"},{status:400});let f=i.RZ.collection("orders").doc(u);if(!(await f.get()).exists)return o.NextResponse.json({message:"Order not found for update"},{status:404});return await f.update(m),o.NextResponse.json({message:"Order updated successfully"},{status:200})}catch(r){console.error("Error updating order:",r);let e="Internal Server Error",t=500;if(r instanceof Error){let s=r.code?.toString();"auth/argument-error"===s||"auth/id-token-expired"===s?(e="Invalid or expired token",t=401):r.message.includes("NOT_FOUND")||r.message.includes("no entity to update")||"5"===s?(e="Order not found",t=404):e=r.message||e}return o.NextResponse.json({message:e},{status:t})}}async function l(e,{params:t}){try{let r=e.headers.get("Authorization");if(!r||!r.startsWith("Bearer "))return o.NextResponse.json({message:"Authorization header missing or malformed"},{status:401});let s=r.split(" ")[1],a=(await i.I8.verifyIdToken(s)).uid,n=(await i.RZ.collection("users").doc(a).get()).data();if(n?.role!=="admin")return o.NextResponse.json({message:"Forbidden - Insufficient permissions"},{status:403});let d=t.id,u=i.RZ.collection("orders").doc(d);if(!(await u.get()).exists)return o.NextResponse.json({message:"Order not found for deletion"},{status:404});return await u.delete(),o.NextResponse.json({message:"Order deleted successfully"},{status:200})}catch(r){console.error("Error deleting order:",r);let e="Internal Server Error",t=500;if(r instanceof Error){let s=r.code?.toString();"auth/argument-error"===s||"auth/id-token-expired"===s?(e="Invalid or expired token",t=401):r.message.includes("NOT_FOUND")||"5"===s?(e="Order not found",t=404):e=r.message||e}return o.NextResponse.json({message:e},{status:t})}}a=(n.then?(await n)():n)[0],s()}catch(e){s(e)}})},84138:(e,t,r)=>{let s,o;r.d(t,{I8:()=>o,RZ:()=>s});let i=require("firebase-admin");if(i.apps.length){let e=i.app();s=e.firestore(),o=e.auth(),console.log("Firebase Admin SDK already initialized.")}else try{i.initializeApp({projectId:process.env.FIREBASE_PROJECT_ID,credential:i.credential.cert({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g,"\n")})}),console.log("Firebase Admin SDK initialized for production mode."),s=i.firestore(),o=i.auth()}catch(e){throw console.error("Firebase admin initialization error:",e),Error("Failed to initialize Firebase Admin SDK.")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(66253));module.exports=s})();