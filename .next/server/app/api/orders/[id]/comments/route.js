"use strict";(()=>{var e={};e.id=339,e.ids=[339],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},18094:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>q,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{POST:()=>g});var n=r(49303),s=r(88716),i=r(60670),a=r(87070);let u=require("mongoose");var d=r.n(u);let p=process.env.MONGODB_URI||"mongodb://localhost:27017/purchase-orders";async function m(){global.mongoose||(global.mongoose={conn:null,promise:null});let e=global.mongoose;return e.conn?e.conn:(e.promise||(e.promise=d().connect(p,{bufferCommands:!1}).then(t=>(e.conn=t,t))),await e.promise)}let c=new u.Schema({title:{type:String,required:!0},description:{type:String,required:!0},requestedBy:{type:u.Schema.Types.ObjectId,ref:"User",required:!0},status:{type:String,enum:["pending","approved","purchased","delivered"],default:"pending",index:!0},priority:{type:String,enum:["low","medium","high"],default:"medium"},price:{type:Number},quantity:{type:Number,required:!0,default:1},url:{type:String},comments:[{type:String}]},{timestamps:!0});c.index({status:1,createdAt:-1});let l=d().models.Order||d().model("Order",c);async function g(e,{params:t}){try{await m();let{comment:r}=await e.json();if(!r||""===r.trim())return a.NextResponse.json({error:"評論不能為空"},{status:400});let o=await l.findByIdAndUpdate(t.id,{$push:{comments:r}},{new:!0});if(!o)return a.NextResponse.json({error:"找不到訂單"},{status:404});return a.NextResponse.json(o,{status:200})}catch(e){return console.error("添加評論錯誤:",e),a.NextResponse.json({error:"添加評論時發生錯誤"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/orders/[id]/comments/route",pathname:"/api/orders/[id]/comments",filename:"route",bundlePath:"app/api/orders/[id]/comments/route"},resolvedPagePath:"/Users/kih/Documents/test/app/api/orders/[id]/comments/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:x}=h,v="/api/orders/[id]/comments/route";function q(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972],()=>r(18094));module.exports=o})();