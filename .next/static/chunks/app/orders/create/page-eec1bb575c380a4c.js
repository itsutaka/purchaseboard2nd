(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[686],{95700:function(e,r,i){Promise.resolve().then(i.bind(i,33361)),Promise.resolve().then(i.bind(i,50096)),Promise.resolve().then(i.bind(i,13390)),Promise.resolve().then(i.bind(i,55996)),Promise.resolve().then(i.bind(i,29928)),Promise.resolve().then(i.bind(i,85643)),Promise.resolve().then(i.bind(i,98785)),Promise.resolve().then(i.bind(i,91902)),Promise.resolve().then(i.bind(i,31718)),Promise.resolve().then(i.bind(i,50591)),Promise.resolve().then(i.bind(i,62068)),Promise.resolve().then(i.bind(i,59747)),Promise.resolve().then(i.bind(i,36624)),Promise.resolve().then(i.bind(i,74883)),Promise.resolve().then(i.bind(i,75292)),Promise.resolve().then(i.bind(i,47400)),Promise.resolve().then(i.bind(i,80876)),Promise.resolve().then(i.bind(i,6994)),Promise.resolve().then(i.bind(i,48524)),Promise.resolve().then(i.bind(i,1879)),Promise.resolve().then(i.bind(i,65362)),Promise.resolve().then(i.bind(i,54429)),Promise.resolve().then(i.bind(i,66890)),Promise.resolve().then(i.bind(i,12405)),Promise.resolve().then(i.bind(i,57883)),Promise.resolve().then(i.bind(i,41394)),Promise.resolve().then(i.bind(i,65819)),Promise.resolve().then(i.bind(i,5479)),Promise.resolve().then(i.bind(i,52531)),Promise.resolve().then(i.bind(i,91105)),Promise.resolve().then(i.bind(i,24811)),Promise.resolve().then(i.bind(i,92754)),Promise.resolve().then(i.bind(i,60342)),Promise.resolve().then(i.bind(i,62054)),Promise.resolve().then(i.bind(i,36946)),Promise.resolve().then(i.bind(i,27499)),Promise.resolve().then(i.bind(i,18114)),Promise.resolve().then(i.bind(i,94563)),Promise.resolve().then(i.bind(i,94891)),Promise.resolve().then(i.bind(i,60767)),Promise.resolve().then(i.bind(i,45652)),Promise.resolve().then(i.bind(i,75522)),Promise.resolve().then(i.bind(i,61832)),Promise.resolve().then(i.bind(i,21183)),Promise.resolve().then(i.bind(i,99193)),Promise.resolve().then(i.bind(i,50584)),Promise.resolve().then(i.bind(i,50551)),Promise.resolve().then(i.bind(i,4216)),Promise.resolve().then(i.bind(i,89948)),Promise.resolve().then(i.bind(i,59260)),Promise.resolve().then(i.bind(i,42999)),Promise.resolve().then(i.bind(i,45796)),Promise.resolve().then(i.bind(i,21967)),Promise.resolve().then(i.bind(i,57833)),Promise.resolve().then(i.bind(i,26440)),Promise.resolve().then(i.bind(i,98559)),Promise.resolve().then(i.bind(i,5641)),Promise.resolve().then(i.bind(i,74743)),Promise.resolve().then(i.bind(i,72341)),Promise.resolve().then(i.bind(i,23324)),Promise.resolve().then(i.bind(i,42789)),Promise.resolve().then(i.bind(i,27640)),Promise.resolve().then(i.bind(i,54548)),Promise.resolve().then(i.bind(i,2323)),Promise.resolve().then(i.bind(i,37903)),Promise.resolve().then(i.bind(i,86437)),Promise.resolve().then(i.bind(i,63752)),Promise.resolve().then(i.bind(i,37895)),Promise.resolve().then(i.bind(i,56819)),Promise.resolve().then(i.bind(i,88530)),Promise.resolve().then(i.bind(i,95294)),Promise.resolve().then(i.bind(i,7161)),Promise.resolve().then(i.bind(i,27994)),Promise.resolve().then(i.bind(i,44250)),Promise.resolve().then(i.bind(i,24898)),Promise.resolve().then(i.bind(i,52558)),Promise.resolve().then(i.bind(i,16352)),Promise.resolve().then(i.bind(i,2718)),Promise.resolve().then(i.bind(i,28803)),Promise.resolve().then(i.bind(i,8906)),Promise.resolve().then(i.bind(i,92326)),Promise.resolve().then(i.bind(i,46823)),Promise.resolve().then(i.bind(i,68106)),Promise.resolve().then(i.bind(i,80449)),Promise.resolve().then(i.bind(i,30249)),Promise.resolve().then(i.bind(i,79756)),Promise.resolve().then(i.bind(i,46743)),Promise.resolve().then(i.bind(i,13340)),Promise.resolve().then(i.bind(i,48420)),Promise.resolve().then(i.bind(i,78330)),Promise.resolve().then(i.bind(i,911)),Promise.resolve().then(i.bind(i,90495)),Promise.resolve().then(i.bind(i,20542)),Promise.resolve().then(i.bind(i,73188)),Promise.resolve().then(i.bind(i,98314)),Promise.resolve().then(i.bind(i,25117)),Promise.resolve().then(i.bind(i,22535)),Promise.resolve().then(i.bind(i,41387)),Promise.resolve().then(i.bind(i,97558)),Promise.resolve().then(i.bind(i,61222)),Promise.resolve().then(i.bind(i,76723)),Promise.resolve().then(i.bind(i,83378)),Promise.resolve().then(i.bind(i,85322)),Promise.resolve().then(i.bind(i,50817)),Promise.resolve().then(i.bind(i,38354)),Promise.resolve().then(i.bind(i,45488)),Promise.resolve().then(i.bind(i,92422)),Promise.resolve().then(i.bind(i,25112)),Promise.resolve().then(i.bind(i,49611)),Promise.resolve().then(i.bind(i,70479)),Promise.resolve().then(i.bind(i,52925)),Promise.resolve().then(i.bind(i,61910)),Promise.resolve().then(i.bind(i,31800)),Promise.resolve().then(i.bind(i,79634)),Promise.resolve().then(i.bind(i,80773)),Promise.resolve().then(i.bind(i,890)),Promise.resolve().then(i.bind(i,12240)),Promise.resolve().then(i.bind(i,73670)),Promise.resolve().then(i.bind(i,66602)),Promise.resolve().then(i.bind(i,7227)),Promise.resolve().then(i.bind(i,93256)),Promise.resolve().then(i.bind(i,92094)),Promise.resolve().then(i.bind(i,25983)),Promise.resolve().then(i.bind(i,12132)),Promise.resolve().then(i.bind(i,35790)),Promise.resolve().then(i.bind(i,51855)),Promise.resolve().then(i.bind(i,92208)),Promise.resolve().then(i.bind(i,75779)),Promise.resolve().then(i.bind(i,33995)),Promise.resolve().then(i.bind(i,74914)),Promise.resolve().then(i.bind(i,9569)),Promise.resolve().then(i.bind(i,37530)),Promise.resolve().then(i.bind(i,73150)),Promise.resolve().then(i.bind(i,46602)),Promise.resolve().then(i.bind(i,95687)),Promise.resolve().then(i.bind(i,27287)),Promise.resolve().then(i.bind(i,3975)),Promise.resolve().then(i.bind(i,70715)),Promise.resolve().then(i.bind(i,21808)),Promise.resolve().then(i.bind(i,37247)),Promise.resolve().then(i.bind(i,95730)),Promise.resolve().then(i.bind(i,53201)),Promise.resolve().then(i.bind(i,14099)),Promise.resolve().then(i.bind(i,32921)),Promise.resolve().then(i.bind(i,54755)),Promise.resolve().then(i.bind(i,30760)),Promise.resolve().then(i.bind(i,91380)),Promise.resolve().then(i.bind(i,89480)),Promise.resolve().then(i.bind(i,43170)),Promise.resolve().then(i.bind(i,48080)),Promise.resolve().then(i.bind(i,75213)),Promise.resolve().then(i.bind(i,4831)),Promise.resolve().then(i.bind(i,40404)),Promise.resolve().then(i.bind(i,72504)),Promise.resolve().then(i.bind(i,58763)),Promise.resolve().then(i.bind(i,89174)),Promise.resolve().then(i.bind(i,94483)),Promise.resolve().then(i.bind(i,88089)),Promise.resolve().then(i.bind(i,86508)),Promise.resolve().then(i.bind(i,30551)),Promise.resolve().then(i.bind(i,18926)),Promise.resolve().then(i.bind(i,20072)),Promise.resolve().then(i.bind(i,80708)),Promise.resolve().then(i.bind(i,35012)),Promise.resolve().then(i.bind(i,3360)),Promise.resolve().then(i.bind(i,36495)),Promise.resolve().then(i.bind(i,45624)),Promise.resolve().then(i.bind(i,27080)),Promise.resolve().then(i.bind(i,14584)),Promise.resolve().then(i.bind(i,55459)),Promise.resolve().then(i.bind(i,43813)),Promise.resolve().then(i.bind(i,96367)),Promise.resolve().then(i.bind(i,60370)),Promise.resolve().then(i.bind(i,73036)),Promise.resolve().then(i.bind(i,60825)),Promise.resolve().then(i.bind(i,89463)),Promise.resolve().then(i.bind(i,14680)),Promise.resolve().then(i.bind(i,74188)),Promise.resolve().then(i.bind(i,38114)),Promise.resolve().then(i.bind(i,70857)),Promise.resolve().then(i.bind(i,20513)),Promise.resolve().then(i.bind(i,75366)),Promise.resolve().then(i.bind(i,50226)),Promise.resolve().then(i.bind(i,56695)),Promise.resolve().then(i.bind(i,13686)),Promise.resolve().then(i.bind(i,47107)),Promise.resolve().then(i.bind(i,81169)),Promise.resolve().then(i.bind(i,56834)),Promise.resolve().then(i.bind(i,56672)),Promise.resolve().then(i.bind(i,72940)),Promise.resolve().then(i.bind(i,40006)),Promise.resolve().then(i.bind(i,56990)),Promise.resolve().then(i.bind(i,62587)),Promise.resolve().then(i.bind(i,39292)),Promise.resolve().then(i.bind(i,33289)),Promise.resolve().then(i.bind(i,37366)),Promise.resolve().then(i.bind(i,59512)),Promise.resolve().then(i.bind(i,52009)),Promise.resolve().then(i.bind(i,88999)),Promise.resolve().then(i.bind(i,44488)),Promise.resolve().then(i.bind(i,30485)),Promise.resolve().then(i.bind(i,2562)),Promise.resolve().then(i.bind(i,7083)),Promise.resolve().then(i.bind(i,32658)),Promise.resolve().then(i.bind(i,56629)),Promise.resolve().then(i.bind(i,72777)),Promise.resolve().then(i.bind(i,12136)),Promise.resolve().then(i.bind(i,14413)),Promise.resolve().then(i.bind(i,71506)),Promise.resolve().then(i.bind(i,60352)),Promise.resolve().then(i.bind(i,34146)),Promise.resolve().then(i.bind(i,87166)),Promise.resolve().then(i.bind(i,81284)),Promise.resolve().then(i.bind(i,44109)),Promise.resolve().then(i.bind(i,65948)),Promise.resolve().then(i.bind(i,30391)),Promise.resolve().then(i.bind(i,86114)),Promise.resolve().then(i.bind(i,5244)),Promise.resolve().then(i.bind(i,11535)),Promise.resolve().then(i.bind(i,78183)),Promise.resolve().then(i.bind(i,60366)),Promise.resolve().then(i.bind(i,64210)),Promise.resolve().then(i.bind(i,77255)),Promise.resolve().then(i.bind(i,90908)),Promise.resolve().then(i.bind(i,67133)),Promise.resolve().then(i.bind(i,2274)),Promise.resolve().then(i.bind(i,86063)),Promise.resolve().then(i.bind(i,15096)),Promise.resolve().then(i.bind(i,27340)),Promise.resolve().then(i.bind(i,54271)),Promise.resolve().then(i.bind(i,47550)),Promise.resolve().then(i.bind(i,5333)),Promise.resolve().then(i.bind(i,19691)),Promise.resolve().then(i.bind(i,44087)),Promise.resolve().then(i.bind(i,80198)),Promise.resolve().then(i.bind(i,31126)),Promise.resolve().then(i.bind(i,73953)),Promise.resolve().then(i.bind(i,25706)),Promise.resolve().then(i.bind(i,52517)),Promise.resolve().then(i.bind(i,82754)),Promise.resolve().then(i.bind(i,13439)),Promise.resolve().then(i.bind(i,18565)),Promise.resolve().then(i.bind(i,45839)),Promise.resolve().then(i.bind(i,59515)),Promise.resolve().then(i.bind(i,13370)),Promise.resolve().then(i.bind(i,58453)),Promise.resolve().then(i.bind(i,87888)),Promise.resolve().then(i.bind(i,62616)),Promise.resolve().then(i.bind(i,91482)),Promise.resolve().then(i.bind(i,50568)),Promise.resolve().then(i.bind(i,65784)),Promise.resolve().then(i.bind(i,51298)),Promise.resolve().then(i.bind(i,10632)),Promise.resolve().then(i.bind(i,35331)),Promise.resolve().then(i.bind(i,60373)),Promise.resolve().then(i.bind(i,58804)),Promise.resolve().then(i.bind(i,69345)),Promise.resolve().then(i.bind(i,52762)),Promise.resolve().then(i.bind(i,34008))},33361:function(e,r,i){"use strict";i.d(r,{default:function(){return I}});var o=i(57437),s=i(13370),n=i(27640),t=i(72940),l=i(60373),d=i(21183),m=i(35331),h=i(39292),v=i(22535),b=i(97558),P=i(890),a=i(41387),u=i(25706),c=i(70857),p=i(4831),x=i(26440),g=i(29501),f=i(2265),j=i(83464),F=i(99376),C=i(70575);function I(){var e,r,i,I,S;let{register:y,handleSubmit:q,formState:{errors:w}}=(0,g.cI)(),[E,A]=(0,f.useState)(!1),k=(0,s.useToast)(),N=(0,F.useRouter)(),{user:O,loading:L}=(0,C.a)();console.log("OrderForm Render - authLoading:",L,"currentUser:",O);let D=async e=>{if(L){console.log("onSubmit - 認證狀態仍在載入中"),k({title:"請稍候",description:"正在確認用戶狀態...",status:"info",duration:3e3,isClosable:!0});return}if(!O){console.log("onSubmit - 使用者未登入"),k({title:"錯誤",description:"請登入以建立訂單",status:"error",duration:3e3,isClosable:!0});return}A(!0);try{let r=await O.getIdToken();if(console.log("OrderForm: Acquired ID Token:",r),!r){console.error("OrderForm: Failed to acquire ID Token."),k({title:"錯誤",description:"獲取用戶認證信息失敗，請稍後重試。",status:"error",duration:3e3,isClosable:!0}),A(!1);return}let i={...e,userId:O.uid,status:"Pending",createdAt:new Date().toISOString()};console.log("準備提交的訂單資料:",i),await j.Z.post("/api/orders",i,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}}),k({title:"訂單已建立",description:"您的購物請求已成功提交",status:"success",duration:5e3,isClosable:!0}),N.push("/orders")}catch(e){if(console.error("OrderForm: Error submitting order:",e),j.Z.isAxiosError(e)){var r,i,o,s,n;(null===(r=e.response)||void 0===r?void 0:r.status)===401?(console.error("OrderForm: API returned 401 Unauthorized. Message:",null===(i=e.response.data)||void 0===i?void 0:i.message),k({title:"提交失敗",description:(null===(o=e.response.data)||void 0===o?void 0:o.message)||"未授權操作，請重新登入。",status:"error",duration:5e3,isClosable:!0})):k({title:"提交失敗",description:(null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.message)||"建立訂單時發生錯誤，請稍後再試",status:"error",duration:5e3,isClosable:!0})}else k({title:"提交失敗",description:"發生未知錯誤。",status:"error",duration:5e3,isClosable:!0})}finally{A(!1)}};return L?(console.log("OrderForm - 顯示 Spinner"),(0,o.jsx)(n.Center,{h:"300px",children:(0,o.jsx)(t.Spinner,{size:"xl"})})):O?(0,o.jsxs)(d.Box,{maxW:"md",mx:"auto",py:10,children:[(0,o.jsx)(m.Heading,{mb:6,children:"建立購物請求"}),(0,o.jsx)("form",{onSubmit:q(D),children:(0,o.jsxs)(h.VStack,{spacing:4,children:[(0,o.jsxs)(v.FormControl,{isInvalid:!!w.title,isRequired:!0,children:[(0,o.jsx)(b.FormLabel,{children:"標題"}),(0,o.jsx)(P.Input,{...y("title",{required:"請輸入標題"}),placeholder:"例如：新筆記型電腦"}),(0,o.jsx)(a.FormErrorMessage,{children:null===(e=w.title)||void 0===e?void 0:e.message})]}),(0,o.jsxs)(v.FormControl,{isInvalid:!!w.description,isRequired:!0,children:[(0,o.jsx)(b.FormLabel,{children:"描述"}),(0,o.jsx)(u.Textarea,{...y("description",{required:"請輸入描述"}),placeholder:"請提供詳細的描述，例如型號、規格等"}),(0,o.jsx)(a.FormErrorMessage,{children:null===(r=w.description)||void 0===r?void 0:r.message})]}),(0,o.jsxs)(v.FormControl,{isInvalid:!!w.priority,isRequired:!0,children:[(0,o.jsx)(b.FormLabel,{children:"優先級"}),(0,o.jsxs)(c.Select,{...y("priority",{required:"請選擇優先級"}),children:[(0,o.jsx)("option",{value:"low",children:"低"}),(0,o.jsx)("option",{value:"medium",children:"中"}),(0,o.jsx)("option",{value:"high",children:"高"})]}),(0,o.jsx)(a.FormErrorMessage,{children:null===(i=w.priority)||void 0===i?void 0:i.message})]}),(0,o.jsxs)(v.FormControl,{isInvalid:!!w.quantity,isRequired:!0,children:[(0,o.jsx)(b.FormLabel,{children:"數量"}),(0,o.jsxs)(p.NumberInput,{min:1,defaultValue:1,children:[(0,o.jsx)(p.NumberInputField,{...y("quantity",{required:"請輸入數量",min:{value:1,message:"數量必須至少為 1"},valueAsNumber:!0})}),(0,o.jsxs)(p.NumberInputStepper,{children:[(0,o.jsx)(p.NumberIncrementStepper,{}),(0,o.jsx)(p.NumberDecrementStepper,{})]})]}),(0,o.jsx)(a.FormErrorMessage,{children:null===(I=w.quantity)||void 0===I?void 0:I.message})]}),(0,o.jsxs)(v.FormControl,{isInvalid:!!w.url,children:[(0,o.jsx)(b.FormLabel,{children:"產品連結 (選填)"}),(0,o.jsx)(P.Input,{...y("url"),placeholder:"例如：https://www.example.com/product"}),(0,o.jsx)(a.FormErrorMessage,{children:null===(S=w.url)||void 0===S?void 0:S.message})]}),(0,o.jsx)(x.Button,{colorScheme:"blue",type:"submit",isLoading:E,width:"full",mt:4,children:"提交購物請求"})]})})]}):(console.log("OrderForm - 顯示登入提示"),(0,o.jsx)(n.Center,{h:"300px",children:(0,o.jsx)(l.Text,{children:"請登入以建立新的購物請求。"})}))}},70575:function(e,r,i){"use strict";i.d(r,{AuthProvider:function(){return m},a:function(){return h}});var o=i(57437),s=i(2265),n=i(43301),t=i(94100),l=i(5978);let d=(0,s.createContext)(void 0),m=e=>{let{children:r}=e,[i,m]=(0,s.useState)(null),[h,v]=(0,s.useState)(!0),[b,P]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=(0,n.Aj)(t.U_,async e=>{if(m(e),e)try{let r=(0,l.JU)(t.$V,"users",e.uid),i=await (0,l.QT)(r);i.exists()?P(i.data()):(console.warn("User document not found in Firestore for UID:",e.uid),P(null))}catch(e){console.error("Error fetching user document:",e),P(null)}finally{v(!1)}else P(null),v(!1)});return v(!0),()=>e()},[]);let a=(null==b?void 0:b.role)==="admin",u=(null==b?void 0:b.role)==="staff"||a;return(0,o.jsx)(d.Provider,{value:{user:i,loading:h,userData:b,isAdmin:a,isStaff:u},children:r})},h=()=>{let e=(0,s.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},94100:function(e,r,i){"use strict";let o;i.d(r,{$V:function(){return d},U_:function(){return l}});var s=i(738),n=i(43301),t=i(5978);(0,s.C6)().length?(o=(0,s.Mq)(),console.log("Firebase Client SDK already initialized.")):(o=(0,s.ZF)({apiKey:"AIzaSyALS2VZcCRA8u7az9ZVNGFCtkLPvHjlERI",authDomain:"bqgracechurch.firebaseapp.com",projectId:"bqgracechurch",storageBucket:"bqgracechurch.firebasestorage.app",messagingSenderId:"751512628182",appId:"1:751512628182:web:7f6991cf5f066dfd821277"}),console.log("Firebase Client SDK initialized."));let l=(0,n.v0)(o),d=(0,t.ad)(o)}},function(e){e.O(0,[358,58,387,815,731,145,464,853,971,117,744],function(){return e(e.s=95700)}),_N_E=e.O()}]);