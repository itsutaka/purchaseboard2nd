(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12],{8198:function(e,r,n){Promise.resolve().then(n.bind(n,38012)),Promise.resolve().then(n.bind(n,50096)),Promise.resolve().then(n.bind(n,13390)),Promise.resolve().then(n.bind(n,55996)),Promise.resolve().then(n.bind(n,29928)),Promise.resolve().then(n.bind(n,85643)),Promise.resolve().then(n.bind(n,98785)),Promise.resolve().then(n.bind(n,91902)),Promise.resolve().then(n.bind(n,31718)),Promise.resolve().then(n.bind(n,50591)),Promise.resolve().then(n.bind(n,62068)),Promise.resolve().then(n.bind(n,59747)),Promise.resolve().then(n.bind(n,36624)),Promise.resolve().then(n.bind(n,74883)),Promise.resolve().then(n.bind(n,75292)),Promise.resolve().then(n.bind(n,47400)),Promise.resolve().then(n.bind(n,80876)),Promise.resolve().then(n.bind(n,6994)),Promise.resolve().then(n.bind(n,48524)),Promise.resolve().then(n.bind(n,1879)),Promise.resolve().then(n.bind(n,65362)),Promise.resolve().then(n.bind(n,54429)),Promise.resolve().then(n.bind(n,66890)),Promise.resolve().then(n.bind(n,12405)),Promise.resolve().then(n.bind(n,57883)),Promise.resolve().then(n.bind(n,41394)),Promise.resolve().then(n.bind(n,65819)),Promise.resolve().then(n.bind(n,5479)),Promise.resolve().then(n.bind(n,52531)),Promise.resolve().then(n.bind(n,91105)),Promise.resolve().then(n.bind(n,24811)),Promise.resolve().then(n.bind(n,92754)),Promise.resolve().then(n.bind(n,60342)),Promise.resolve().then(n.bind(n,62054)),Promise.resolve().then(n.bind(n,36946)),Promise.resolve().then(n.bind(n,27499)),Promise.resolve().then(n.bind(n,18114)),Promise.resolve().then(n.bind(n,94563)),Promise.resolve().then(n.bind(n,94891)),Promise.resolve().then(n.bind(n,60767)),Promise.resolve().then(n.bind(n,45652)),Promise.resolve().then(n.bind(n,75522)),Promise.resolve().then(n.bind(n,61832)),Promise.resolve().then(n.bind(n,21183)),Promise.resolve().then(n.bind(n,99193)),Promise.resolve().then(n.bind(n,50584)),Promise.resolve().then(n.bind(n,50551)),Promise.resolve().then(n.bind(n,4216)),Promise.resolve().then(n.bind(n,89948)),Promise.resolve().then(n.bind(n,59260)),Promise.resolve().then(n.bind(n,42999)),Promise.resolve().then(n.bind(n,45796)),Promise.resolve().then(n.bind(n,21967)),Promise.resolve().then(n.bind(n,57833)),Promise.resolve().then(n.bind(n,26440)),Promise.resolve().then(n.bind(n,98559)),Promise.resolve().then(n.bind(n,5641)),Promise.resolve().then(n.bind(n,74743)),Promise.resolve().then(n.bind(n,72341)),Promise.resolve().then(n.bind(n,23324)),Promise.resolve().then(n.bind(n,42789)),Promise.resolve().then(n.bind(n,27640)),Promise.resolve().then(n.bind(n,54548)),Promise.resolve().then(n.bind(n,2323)),Promise.resolve().then(n.bind(n,37903)),Promise.resolve().then(n.bind(n,86437)),Promise.resolve().then(n.bind(n,63752)),Promise.resolve().then(n.bind(n,37895)),Promise.resolve().then(n.bind(n,56819)),Promise.resolve().then(n.bind(n,88530)),Promise.resolve().then(n.bind(n,95294)),Promise.resolve().then(n.bind(n,7161)),Promise.resolve().then(n.bind(n,27994)),Promise.resolve().then(n.bind(n,44250)),Promise.resolve().then(n.bind(n,24898)),Promise.resolve().then(n.bind(n,52558)),Promise.resolve().then(n.bind(n,16352)),Promise.resolve().then(n.bind(n,2718)),Promise.resolve().then(n.bind(n,28803)),Promise.resolve().then(n.bind(n,8906)),Promise.resolve().then(n.bind(n,92326)),Promise.resolve().then(n.bind(n,46823)),Promise.resolve().then(n.bind(n,68106)),Promise.resolve().then(n.bind(n,80449)),Promise.resolve().then(n.bind(n,30249)),Promise.resolve().then(n.bind(n,79756)),Promise.resolve().then(n.bind(n,46743)),Promise.resolve().then(n.bind(n,13340)),Promise.resolve().then(n.bind(n,48420)),Promise.resolve().then(n.bind(n,78330)),Promise.resolve().then(n.bind(n,911)),Promise.resolve().then(n.bind(n,90495)),Promise.resolve().then(n.bind(n,20542)),Promise.resolve().then(n.bind(n,73188)),Promise.resolve().then(n.bind(n,98314)),Promise.resolve().then(n.bind(n,25117)),Promise.resolve().then(n.bind(n,22535)),Promise.resolve().then(n.bind(n,41387)),Promise.resolve().then(n.bind(n,97558)),Promise.resolve().then(n.bind(n,61222)),Promise.resolve().then(n.bind(n,76723)),Promise.resolve().then(n.bind(n,83378)),Promise.resolve().then(n.bind(n,85322)),Promise.resolve().then(n.bind(n,50817)),Promise.resolve().then(n.bind(n,38354)),Promise.resolve().then(n.bind(n,45488)),Promise.resolve().then(n.bind(n,92422)),Promise.resolve().then(n.bind(n,25112)),Promise.resolve().then(n.bind(n,49611)),Promise.resolve().then(n.bind(n,70479)),Promise.resolve().then(n.bind(n,52925)),Promise.resolve().then(n.bind(n,61910)),Promise.resolve().then(n.bind(n,31800)),Promise.resolve().then(n.bind(n,79634)),Promise.resolve().then(n.bind(n,80773)),Promise.resolve().then(n.bind(n,890)),Promise.resolve().then(n.bind(n,12240)),Promise.resolve().then(n.bind(n,73670)),Promise.resolve().then(n.bind(n,66602)),Promise.resolve().then(n.bind(n,7227)),Promise.resolve().then(n.bind(n,93256)),Promise.resolve().then(n.bind(n,92094)),Promise.resolve().then(n.bind(n,25983)),Promise.resolve().then(n.bind(n,12132)),Promise.resolve().then(n.bind(n,35790)),Promise.resolve().then(n.bind(n,51855)),Promise.resolve().then(n.bind(n,92208)),Promise.resolve().then(n.bind(n,75779)),Promise.resolve().then(n.bind(n,33995)),Promise.resolve().then(n.bind(n,74914)),Promise.resolve().then(n.bind(n,9569)),Promise.resolve().then(n.bind(n,37530)),Promise.resolve().then(n.bind(n,73150)),Promise.resolve().then(n.bind(n,46602)),Promise.resolve().then(n.bind(n,95687)),Promise.resolve().then(n.bind(n,27287)),Promise.resolve().then(n.bind(n,3975)),Promise.resolve().then(n.bind(n,70715)),Promise.resolve().then(n.bind(n,21808)),Promise.resolve().then(n.bind(n,37247)),Promise.resolve().then(n.bind(n,95730)),Promise.resolve().then(n.bind(n,53201)),Promise.resolve().then(n.bind(n,14099)),Promise.resolve().then(n.bind(n,32921)),Promise.resolve().then(n.bind(n,54755)),Promise.resolve().then(n.bind(n,30760)),Promise.resolve().then(n.bind(n,91380)),Promise.resolve().then(n.bind(n,89480)),Promise.resolve().then(n.bind(n,43170)),Promise.resolve().then(n.bind(n,48080)),Promise.resolve().then(n.bind(n,75213)),Promise.resolve().then(n.bind(n,4831)),Promise.resolve().then(n.bind(n,40404)),Promise.resolve().then(n.bind(n,72504)),Promise.resolve().then(n.bind(n,58763)),Promise.resolve().then(n.bind(n,89174)),Promise.resolve().then(n.bind(n,94483)),Promise.resolve().then(n.bind(n,88089)),Promise.resolve().then(n.bind(n,86508)),Promise.resolve().then(n.bind(n,30551)),Promise.resolve().then(n.bind(n,18926)),Promise.resolve().then(n.bind(n,20072)),Promise.resolve().then(n.bind(n,80708)),Promise.resolve().then(n.bind(n,35012)),Promise.resolve().then(n.bind(n,3360)),Promise.resolve().then(n.bind(n,36495)),Promise.resolve().then(n.bind(n,45624)),Promise.resolve().then(n.bind(n,27080)),Promise.resolve().then(n.bind(n,14584)),Promise.resolve().then(n.bind(n,55459)),Promise.resolve().then(n.bind(n,43813)),Promise.resolve().then(n.bind(n,96367)),Promise.resolve().then(n.bind(n,60370)),Promise.resolve().then(n.bind(n,73036)),Promise.resolve().then(n.bind(n,60825)),Promise.resolve().then(n.bind(n,89463)),Promise.resolve().then(n.bind(n,14680)),Promise.resolve().then(n.bind(n,74188)),Promise.resolve().then(n.bind(n,38114)),Promise.resolve().then(n.bind(n,70857)),Promise.resolve().then(n.bind(n,20513)),Promise.resolve().then(n.bind(n,75366)),Promise.resolve().then(n.bind(n,50226)),Promise.resolve().then(n.bind(n,56695)),Promise.resolve().then(n.bind(n,13686)),Promise.resolve().then(n.bind(n,47107)),Promise.resolve().then(n.bind(n,81169)),Promise.resolve().then(n.bind(n,56834)),Promise.resolve().then(n.bind(n,56672)),Promise.resolve().then(n.bind(n,72940)),Promise.resolve().then(n.bind(n,40006)),Promise.resolve().then(n.bind(n,56990)),Promise.resolve().then(n.bind(n,62587)),Promise.resolve().then(n.bind(n,39292)),Promise.resolve().then(n.bind(n,33289)),Promise.resolve().then(n.bind(n,37366)),Promise.resolve().then(n.bind(n,59512)),Promise.resolve().then(n.bind(n,52009)),Promise.resolve().then(n.bind(n,88999)),Promise.resolve().then(n.bind(n,44488)),Promise.resolve().then(n.bind(n,30485)),Promise.resolve().then(n.bind(n,2562)),Promise.resolve().then(n.bind(n,7083)),Promise.resolve().then(n.bind(n,32658)),Promise.resolve().then(n.bind(n,56629)),Promise.resolve().then(n.bind(n,72777)),Promise.resolve().then(n.bind(n,12136)),Promise.resolve().then(n.bind(n,14413)),Promise.resolve().then(n.bind(n,71506)),Promise.resolve().then(n.bind(n,60352)),Promise.resolve().then(n.bind(n,34146)),Promise.resolve().then(n.bind(n,87166)),Promise.resolve().then(n.bind(n,81284)),Promise.resolve().then(n.bind(n,44109)),Promise.resolve().then(n.bind(n,65948)),Promise.resolve().then(n.bind(n,30391)),Promise.resolve().then(n.bind(n,86114)),Promise.resolve().then(n.bind(n,5244)),Promise.resolve().then(n.bind(n,11535)),Promise.resolve().then(n.bind(n,78183)),Promise.resolve().then(n.bind(n,60366)),Promise.resolve().then(n.bind(n,64210)),Promise.resolve().then(n.bind(n,77255)),Promise.resolve().then(n.bind(n,90908)),Promise.resolve().then(n.bind(n,67133)),Promise.resolve().then(n.bind(n,2274)),Promise.resolve().then(n.bind(n,86063)),Promise.resolve().then(n.bind(n,15096)),Promise.resolve().then(n.bind(n,27340)),Promise.resolve().then(n.bind(n,54271)),Promise.resolve().then(n.bind(n,47550)),Promise.resolve().then(n.bind(n,5333)),Promise.resolve().then(n.bind(n,19691)),Promise.resolve().then(n.bind(n,44087)),Promise.resolve().then(n.bind(n,80198)),Promise.resolve().then(n.bind(n,31126)),Promise.resolve().then(n.bind(n,73953)),Promise.resolve().then(n.bind(n,25706)),Promise.resolve().then(n.bind(n,52517)),Promise.resolve().then(n.bind(n,82754)),Promise.resolve().then(n.bind(n,13439)),Promise.resolve().then(n.bind(n,18565)),Promise.resolve().then(n.bind(n,45839)),Promise.resolve().then(n.bind(n,59515)),Promise.resolve().then(n.bind(n,13370)),Promise.resolve().then(n.bind(n,58453)),Promise.resolve().then(n.bind(n,87888)),Promise.resolve().then(n.bind(n,62616)),Promise.resolve().then(n.bind(n,91482)),Promise.resolve().then(n.bind(n,50568)),Promise.resolve().then(n.bind(n,65784)),Promise.resolve().then(n.bind(n,51298)),Promise.resolve().then(n.bind(n,10632)),Promise.resolve().then(n.bind(n,35331)),Promise.resolve().then(n.bind(n,60373)),Promise.resolve().then(n.bind(n,58804)),Promise.resolve().then(n.bind(n,69345)),Promise.resolve().then(n.bind(n,52762)),Promise.resolve().then(n.bind(n,34008))},38012:function(e,r,n){"use strict";n.d(r,{default:function(){return T}});var i=n(57437),s=n(13370),o=n(27640),t=n(72940),l=n(21183),d=n(35331),h=n(60373),m=n(98314),v=n(61832),b=n(73953),P=n(66602),a=n(8906),c=n(62587),u=n(22535),x=n(97558),p=n(70857),g=n(890),j=n(26440),f=n(25706),y=n(2265),S=n(50364),C=n(83464),w=n(70575);function T(e){var r,n,T;let{order:A}=e,z=(0,s.useToast)(),{user:I,loading:k,isAdmin:B,isStaff:D,userData:F}=(0,w.a)(),[E,H]=(0,y.useState)(A),[Z,L]=(0,y.useState)(!1),[N,_]=(0,y.useState)(!1),[q,M]=(0,y.useState)(E.status),[O,U]=(0,y.useState)(E.price||""),[V,K]=(0,y.useState)(E.url||""),[W,$]=(0,y.useState)("");if(k)return(0,i.jsx)(o.Center,{h:"300px",children:(0,i.jsx)(t.Spinner,{size:"xl"})});let R=async()=>{if(I){L(!0);try{let e=await I.getIdToken();await C.Z.patch("/api/orders/".concat(E.id),{status:q,price:""===O?null:Number(O),url:""===V?null:V},{headers:{Authorization:"Bearer ".concat(e)}}),z({title:"狀態已更新",description:"訂單狀態已更新為 ".concat(q),status:"success",duration:3e3,isClosable:!0}),H(e=>({...e,status:q,price:""===O?void 0:Number(O),url:""===V?void 0:V,updatedAt:new Date().toISOString()}))}catch(i){let n="無法更新訂單狀態";if(C.Z.isAxiosError(i)){var e,r;n=(null===(r=i.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||n}z({title:"更新失敗",description:n,status:"error",duration:3e3,isClosable:!0})}finally{L(!1)}}},G=async()=>{if(I&&W.trim()){_(!0);try{let e=await I.getIdToken();await C.Z.post("/api/orders/".concat(E.id),{comment:W.trim()},{headers:{Authorization:"Bearer ".concat(e)}}),z({title:"評論已添加",status:"success",duration:3e3,isClosable:!0}),$("");let r={text:W.trim(),authorId:I.uid,authorName:(null==F?void 0:F.name)||I.email||"未知用戶",createdAt:new Date().toISOString()};H(e=>({...e,comments:[...e.comments||[],r],updatedAt:new Date().toISOString()}))}catch(i){let n="添加評論失敗";if(C.Z.isAxiosError(i)){var e,r;n=(null===(r=i.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||n}z({title:"添加評論失敗",description:n,status:"error",duration:3e3,isClosable:!0})}finally{_(!1)}}};return(0,i.jsxs)(l.Box,{maxW:"container.xl",mx:"auto",children:[(0,i.jsx)(d.Heading,{mb:4,children:E.title}),(0,i.jsxs)(h.Text,{fontSize:"lg",color:"gray.600",mb:4,children:["申請人: ",E.requestedBy.name," (",E.requestedBy.email,")"]}),(0,i.jsxs)(m.Flex,{align:"center",mb:4,children:[(0,i.jsx)(v.Badge,{colorScheme:(e=>{switch(e){case"pending":return"yellow";case"approved":return"blue";case"purchased":return"purple";case"delivered":return"green";default:return"gray"}})(E.status),fontSize:"md",mr:2,children:E.status}),(0,i.jsx)(b.Tag,{size:"md",colorScheme:(e=>{switch(e){case"high":return"red";case"medium":return"orange";case"low":return"green";default:return"gray"}})(E.priority),children:E.priority}),void 0!==E.price&&null!==E.price&&(0,i.jsxs)(h.Text,{fontSize:"lg",ml:4,children:["價格: NT$ ",E.price.toLocaleString()]})]}),(0,i.jsxs)(h.Text,{mb:4,children:["數量: ",E.quantity]}),E.url&&(0,i.jsxs)(h.Text,{mb:4,children:["產品連結: "," ",(0,i.jsx)(P.Link,{href:E.url,isExternal:!0,color:"blue.500",children:E.url})]}),(0,i.jsx)(h.Text,{mb:4,children:E.description}),(0,i.jsxs)(h.Text,{fontSize:"sm",color:"gray.500",mb:6,children:["建立時間: ",(0,S.Z)(new Date(E.createdAt),"yyyy-MM-dd HH:mm")," • 更新時間: ",(0,S.Z)(new Date(E.updatedAt),"yyyy-MM-dd HH:mm")]}),(0,i.jsx)(a.Divider,{mb:6}),(D||B)&&(0,i.jsxs)(l.Box,{mb:8,children:[(0,i.jsx)(d.Heading,{size:"md",mb:4,children:"管理操作"}),(0,i.jsxs)(c.Stack,{spacing:4,children:[(0,i.jsxs)(u.FormControl,{id:"status",children:[(0,i.jsx)(x.FormLabel,{children:"更新狀態"}),(0,i.jsxs)(p.Select,{value:q,onChange:e=>M(e.target.value),children:[(0,i.jsx)("option",{value:"pending",children:"待審核"}),(0,i.jsx)("option",{value:"approved",children:"已批准"}),(0,i.jsx)("option",{value:"purchased",children:"已購買"}),(0,i.jsx)("option",{value:"delivered",children:"已送達"})]})]}),(0,i.jsxs)(u.FormControl,{id:"price",children:[(0,i.jsx)(x.FormLabel,{children:"更新價格 (選填)"}),(0,i.jsx)(g.Input,{type:"number",value:O,onChange:e=>U(e.target.value),placeholder:"輸入價格"})]}),(0,i.jsxs)(u.FormControl,{id:"url",children:[(0,i.jsx)(x.FormLabel,{children:"更新產品連結 (選填)"}),(0,i.jsx)(g.Input,{type:"url",value:V,onChange:e=>K(e.target.value),placeholder:"輸入產品連結"})]}),(0,i.jsx)(j.Button,{colorScheme:"green",onClick:R,isLoading:Z,children:"確認更新"})]})]}),(0,i.jsx)(a.Divider,{mb:6}),(0,i.jsxs)(l.Box,{mb:8,children:[(0,i.jsxs)(d.Heading,{size:"md",mb:4,children:["評論 (",(null===(r=E.comments)||void 0===r?void 0:r.length)||0,")"]}),(0,i.jsxs)(c.Stack,{spacing:4,mb:4,children:[null===(n=E.comments)||void 0===n?void 0:n.map((e,r)=>(0,i.jsxs)(l.Box,{p:4,shadow:"md",borderWidth:"1px",children:[(0,i.jsxs)(h.Text,{fontWeight:"bold",children:[e.authorName," ",(0,i.jsxs)(h.Text,{as:"span",fontSize:"sm",color:"gray.500",children:["(",(0,S.Z)(new Date(e.createdAt),"yyyy-MM-dd HH:mm"),")"]})]}),(0,i.jsx)(h.Text,{mt:1,children:e.text})]},r)),(null===(T=E.comments)||void 0===T?void 0:T.length)===0&&(0,i.jsx)(h.Text,{color:"gray.500",children:"目前沒有評論。"})]}),I&&(0,i.jsxs)(l.Box,{children:[(0,i.jsx)(f.Textarea,{placeholder:"添加評論...",value:W,onChange:e=>$(e.target.value),mb:2}),(0,i.jsx)(j.Button,{colorScheme:"blue",onClick:G,isLoading:N,children:"添加評論"})]}),!I&&(0,i.jsx)(h.Text,{color:"gray.500",children:"請登入以添加評論。"})]})]})}},70575:function(e,r,n){"use strict";n.d(r,{AuthProvider:function(){return h},a:function(){return m}});var i=n(57437),s=n(2265),o=n(43301),t=n(94100),l=n(5978);let d=(0,s.createContext)(void 0),h=e=>{let{children:r}=e,[n,h]=(0,s.useState)(null),[m,v]=(0,s.useState)(!0),[b,P]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=(0,o.Aj)(t.U_,async e=>{if(h(e),e)try{let r=(0,l.JU)(t.$V,"users",e.uid),n=await (0,l.QT)(r);n.exists()?P(n.data()):(console.warn("User document not found in Firestore for UID:",e.uid),P(null))}catch(e){console.error("Error fetching user document:",e),P(null)}finally{v(!1)}else P(null),v(!1)});return v(!0),()=>e()},[]);let a=(null==b?void 0:b.role)==="admin",c=(null==b?void 0:b.role)==="staff"||a;return(0,i.jsx)(d.Provider,{value:{user:n,loading:m,userData:b,isAdmin:a,isStaff:c},children:r})},m=()=>{let e=(0,s.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},94100:function(e,r,n){"use strict";let i;n.d(r,{$V:function(){return d},U_:function(){return l}});var s=n(738),o=n(43301),t=n(5978);(0,s.C6)().length?(i=(0,s.Mq)(),console.log("Firebase Client SDK already initialized.")):(i=(0,s.ZF)({apiKey:"AIzaSyALS2VZcCRA8u7az9ZVNGFCtkLPvHjlERI",authDomain:"bqgracechurch.firebaseapp.com",projectId:"bqgracechurch",storageBucket:"bqgracechurch.firebasestorage.app",messagingSenderId:"751512628182",appId:"1:751512628182:web:7f6991cf5f066dfd821277"}),console.log("Firebase Client SDK initialized."));let l=(0,o.v0)(i),d=(0,t.ad)(i)}},function(e){e.O(0,[358,58,387,815,731,145,464,364,971,117,744],function(){return e(e.s=8198)}),_N_E=e.O()}]);